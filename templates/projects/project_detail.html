{% extends 'base.html' %}
{% load staticfiles %}
{% load humanize %}

{% block title %}{{project}}{% endblock %}

{% block more_css %}
<link rel="stylesheet" href="{% static 'css/datatables/bootstrap.min.css' %}">
<link rel="stylesheet" href="{% static 'css/datatables/dataTables.bootstrap.min.css' %}">
<link rel="stylesheet" href="{% static 'css/datatables/datatables.min.css' %}">
<link rel="stylesheet" href="{% static 'css/datatables/dataTables.fontAwesome.css' %}">
{% endblock %}

{% block main-title %}dashboard-page{% endblock %}

{% block content %}
<div class="title-search-block">
    <div class="title-block">
      <div class="row">
        <div class="col-md-6">
            <h3 class="title"> {{project}} </h3>
            <p class="title-description">
                <strong>Encargado:</strong> {{project.attendant}} 
                <br>
                <strong>Estado: </strong> {{project.get_status_display}}
                <br>
                <strong>Creado por: </strong>{{user}}
            </p>
        </div>
      </div>
      <div class="items-search">
        <a href="{% url 'projects:project_edit' project.id %}" class="btn btn-primary"><i class="fa fa-pencil"></i> Editar Proyecto</a>
      </div>
    </div>
  </div>
<section class="section ">
  <div class="row">
    <div class="col col-sm-12 col-md-4">
      <div class="card card-primary sameheight-item">
        <div class="card-header">
          <div class="header-block">
            <p class="title">Información general</p>
          </div>
        </div>
        <div class="card-block">
          <p><strong>Dirrección: </strong> {{project.location}}</p>
          <p><strong>Tipo de Proyecto: </strong> {{project.get_project_type_display}}</p>
        </div>
          <div class="card-footer">
          <p>Fecha de Creación: {{project.create_time}}</p>
          </div>
      </div>
    </div>
    <div class="col-sm-12 col-md-8">
      <div class="card card-info sameheight-item items" data-exclude="xs,sm,lg">
        <div class="card-header bordered">
          <div class="header-block">
            <h3 class="title"> Items </h3>
          </div>
          <div class="header-block pull-right">
            <a href="{% url 'items:file_new' project.id %}" class="btn btn-primary btn-sm">
              <i class="fa fa-plus fa-lg"></i> Agregar Item
            </a>
          </div>
        </div>
        <div class="card-block">
          <table id="item-table" class="table table-striped table-bordered" cellspacing="0" width="100%">
            <thead>
              <tr>
                  <th>Nombre</th>
                  <th>Encargado</th>
                  <th>Ultima Actualización</th>
                  <th></th>
                </tr>
            </thead>
            <tbody>
              {% for file in files %}
              <tr>
                <td><a href="">{{file.item}}</a></td>
                <td>{{file.item.attendant}}</td>
                <td>{{file.update_time}}</td>
                <td>
                  <div class="btn-group-vertical btn-group-sm">
                    <a href="{% url 'items:file_edit' project.id file.id %}" class="btn btn-primary-outline btn-sm"><i class="fa fa-pencil fa-lg"></i> Editar</a>
                    <a class="btn btn-danger-outline btn-sm" href=""> <i class="fa fa-trash-o fa-lg"></i> Borrar</a>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
      <div class="col-xs-12">
        <div class="card card-info sameheight-item items" data-exclude="xs,sm,lg">
          <div class="card-header bordered">
            {% if project.budget %}
            <div class="header-block">
              <h3 class="title"> {{project.budget}} </h3>
            </div>
            <div class="header-block pull-right">
              <a href="{% url 'projects:entry_new' project.id project.budget.id %}" class="btn btn-primary btn-sm">
                  <i class="fa fa-plus fa-lg"></i> Agregar Rubro
              </a>
              <a href="{% url 'projects:budget_edit' project.id project.budget.id %}" class="btn btn-primary btn-sm">
                <i class="fa fa-pencil fa-lg"></i> Editar Presupuesto
              </a>
            </div>
            {% else %}
            <div class="header-block">
              <h3 class="title"> 
                Este proyecto aún no tiene presupuesto
              </h3>
            </div>
            {% endif %}
          </div>
          <div class="card-block">
            {% if project.budget %}
            <table id="budget-table" class="table table-striped table-bordered" cellspacing="0" width="100%">
              <thead>
                <tr>
                    <th>Descripción</th>
                    <th>Cantidad</th>
                    <th>Unidad</th>
                    <th>Costo Unitario</th>
                    <th>Costo Total</th>
                    <th></th>
                  </tr>
              </thead>
              <tbody>
                {% for entry in project.budget.entry_set.all %}
                <tr>
                  <td>{{entry.description}}</td>
                  <td>{{entry.quantity}}</td>
                  <td>{{entry.unity}}</td>
                  <td>Q. {{entry.unit_cost|floatformat:2|intcomma}}</td>
                  <td>Q. {{entry.total_cost|floatformat:2|intcomma}}</td>
                  <td>
                    <div class="btn-group-vertical btn-group-sm">
                      <a href="{% url 'projects:entry_edit' project.id entry.id %}" class="btn btn-primary-outline btn-sm"><i class="fa fa-pencil fa-lg"></i> Editar</a>
                      <a class="btn btn-danger-outline btn-sm" href=""> <i class="fa fa-trash-o fa-lg"></i> Borrar</a>
                    </div>    
                  </td>
                </tr>
                {% endfor %}
              </tbody>
              <tfoot align="right">
                <tr><th></th><th></th><th></th><th></th><th></th></tr>
              </tfoot>
            </table>
            {% else %}
            <div class="text-sm-center">
              <a href="{% url 'projects:budget_new' project.id %}" class="btn btn-lg btn-success">
                <i class="fa fa-plus fa-5x"></i> <h1><strong>Crea uno</strong></h1>
              </a>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
</section>
{% endblock %}

{% block js %}
<script src="{% static 'js/datatables/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'js/datatables/moment.min.js' %}"></script>
<script src="{% static 'js/datatables/datatables.min.js' %}"></script>
<script src="{% static 'js/datatables/datetime-moment.js' %}"></script>
<script src="{% static 'js/datatables/dataTables.bootstrap.min.js' %}"></script>
<script>
  $(document).ready(function() {
    $.fn.dataTable.moment( 'MMM D, YYYY, h:mm a' );

    $('#item-table').DataTable( {
      responsive: "True",
      lengthMenu: [ 5, 10, 25, 50],
      language: {
        search: "Buscar",
        infoEmpty:      "No hay entradas disponibles para mostrar.",
        info:           "Mostrando _START_ a _END_ de _TOTAL_ entradas",
        lengthMenu:     "Mostrar _MENU_ entradas",
        zeroRecords:    "No se encontraron datos en esta tabla",
        paginate: {
          first:      "Primero",
          last:       "Ultimo",
          next:       "Siguiente",
          previous:   "Anterior"
        },
      }
    });

    $('#budget-table').DataTable( {

        responsive: "True",
        lengthMenu: [ 5, 10, 25, 50],
        language: {
          search: "Buscar",
          infoEmpty:      "No hay entradas disponibles para mostrar.",
          info:           "Mostrando _START_ a _END_ de _TOTAL_ entradas",
          lengthMenu:     "Mostrar _MENU_ entradas",
          zeroRecords:    "No se encontraron datos en esta tabla",
          paginate: {
            first:      "Primero",
            last:       "Ultimo",
            next:       "Siguiente",
            previous:   "Anterior"
          },
        }
    });
  });
</script>
{% endblock %}
